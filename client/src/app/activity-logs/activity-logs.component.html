<div class="container-fluid container-fluid-sm container-fluid-md container-fluid-lg container-fluid-xl">

    <br>
    <div class="row table__row">
        <mat-card class="table__card">
            <mat-progress-bar mode="indeterminate" *ngIf="showProgressBar"></mat-progress-bar>
            <mat-card-header class="table__header">
                <div style="width:100%;display:flex;flex-direction:row;align-items:center;justify-content:space-between;">
                  <h2 style="margin:0;">Login Activity Logs</h2>
                  <div style="display:flex;align-items:center;gap:10px;">
                    <!-- From Date Filter -->
                    <mat-form-field appearance="standard" style="min-width:150px;">
                        <mat-label>From Date</mat-label>
                        <input matInput type="date" [(ngModel)]="selectedFromDate" (change)="onFromDateChange()">
                    </mat-form-field>
                    
                    <!-- To Date Filter -->
                    <mat-form-field appearance="standard" style="min-width:150px;">
                        <mat-label>To Date</mat-label>
                        <input matInput type="date" [(ngModel)]="selectedToDate" (change)="onToDateChange()">
                    </mat-form-field>
                    
                    <!-- User Filter -->
                    <mat-form-field appearance="standard" style="min-width:200px;">
                        <mat-label>Filter by User</mat-label>
                        <input matInput [matAutocomplete]="userAuto" [formControl]="userControl">
                        <mat-autocomplete #userAuto="matAutocomplete" [displayWith]="displayUser">
                            <mat-option *ngFor="let user of filteredUsers | async" [value]="user">
                                {{user.first_name}} {{user.last_name}}
                            </mat-option>
                        </mat-autocomplete>
                    </mat-form-field>
                    
                    <!-- Clear User Filter -->
                    <button mat-icon-button (click)="clearUserFilter()" matTooltip="Clear user filter">
                        <mat-icon>clear</mat-icon>
                    </button>
                    
                    <!-- Search -->
                    <mat-form-field appearance="standard" style="min-width:250px;">
                        <mat-label>Type here to filter</mat-label>
                        <input matInput (keyup)="applyFilter($event)" #input>
                    </mat-form-field>
                  </div>
                </div>
            </mat-card-header>
            <div class="activity-log-info">
                <p><strong>Showing login activity logs based on your role hierarchy</strong></p>
                <p>Showing {{resultsLength}} login records</p>
            </div>
            <div class="mat-elevation-z8">
                <table mat-table [dataSource]="dataSource" matSort>
                    <ng-container matColumnDef="activity_dtm">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header> Date </th>
                        <td mat-cell *matCellDef="let row; let i=index" data-label="Activity Date Time"> 
                            {{row.activity_dtm | date:'MMM d, yyyy h:mm a':'IST'}} 
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="full_name">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header> User Name </th>
                        <td mat-cell *matCellDef="let row" data-label="Full Name"> {{row.full_name}} </td>
                    </ng-container>
                    <ng-container matColumnDef="activity_type">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header> Activity Type </th>
                        <td mat-cell *matCellDef="let row" data-label="Activity Type"> 
                            <span class="activity-type-badge" [ngClass]="'activity-' + row.activity_type.toLowerCase()">
                                {{formatActivityType(row.activity_type, row)}}
                            </span>
                        </td>
                    </ng-container>


                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>


                    <tr class="mat-row" *matNoDataRow class="msg">
                        <td class="mat-cell" colspan="3">No login data found</td>
                    </tr>
                </table>
            </div>
        </mat-card>
    </div>
</div>