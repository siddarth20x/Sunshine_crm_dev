<div class="container-fluid">
    <br>
    <div class="_rows">
        <div class="col-sm btn_row">
            <button mat-raised-button (click)="openNewPaymentDialog()">New Payment</button>
        </div>
    </div>
    <mat-card class="table__card">
        <mat-progress-bar mode="indeterminate" *ngIf="showProgressBar"></mat-progress-bar>
        <mat-card-header class="table__header">
            <!-- <mat-card-title> </mat-card-title>
            <mat-card-subtitle></mat-card-subtitle> -->
            <mat-form-field appearance="standard">
                <mat-label>Filter Payments</mat-label>
                <input matInput (keyup)="applyFilter($event)" #input>
            </mat-form-field>
        </mat-card-header>
        <div class="mat-elevation-z8">
            <table mat-table [dataSource]="dataSource" matSort multiTemplateDataRows>
                <ng-container matColumnDef="task_id">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Task</th>
                    <td mat-cell *matCellDef="let row" (click)="viewPaymentLedgerEntry(row)" data-label="Task">
                        {{row.task_id}}
                    </td>
                </ng-container>
                <ng-container matColumnDef="lead_payment_ledger_id">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>No.</th>
                    <td mat-cell *matCellDef="let row" (click)="viewPaymentLedgerEntry(row)" data-label="No.">
                        {{row.lead_payment_ledger_id}}
                    </td>
                </ng-container>
                <ng-container matColumnDef="credit_limit">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Credit Limit</th>
                    <td mat-cell *matCellDef="let row" (click)="viewPaymentLedgerEntry(row)" data-label="Credit Limit">
                        {{row.credit_limit || '-'}}
                    </td>
                </ng-container>
                <ng-container matColumnDef="principal_outstanding_amount">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Principal Outstanding</th>
                    <td mat-cell *matCellDef="let row" (click)="viewPaymentLedgerEntry(row)"
                        data-label="Principal Outstanding">
                        {{row.principal_outstanding_amount || '-'}}</td>
                </ng-container>
                <ng-container matColumnDef="total_outstanding_amount">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Total Outstanding</th>
                    <td mat-cell *matCellDef="let row" (click)="viewPaymentLedgerEntry(row)"
                        data-label="Total Outstanding">
                        {{row.total_outstanding_amount || '-'}}</td>
                </ng-container>
                <ng-container matColumnDef="minimum_payment">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Minimum Payment</th>
                    <td mat-cell *matCellDef="let row" (click)="viewPaymentLedgerEntry(row)"
                        data-label="Minimum Payment">{{row.minimum_payment}}
                    </td>
                </ng-container>
                <ng-container matColumnDef="last_paid_amount">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Last Paid Amount</th>
                    <td mat-cell *matCellDef="let row" (click)="viewPaymentLedgerEntry(row)"
                        data-label="Last Paid Amount">
                        {{row.last_paid_amount}}</td>
                </ng-container>
                <ng-container matColumnDef="last_paid_date">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Last Paid Date</th>
                    <td mat-cell *matCellDef="let row" (click)="viewPaymentLedgerEntry(row)"
                        data-label="Last Paid Date">{{row.last_paid_date |
                        date:'dd-MMM-yyyy'}}</td>
                </ng-container>

                <!-- New Payment Ledger Fields -->
                <ng-container matColumnDef="fresh_stab">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Fresh/Stab</th>
                    <td mat-cell *matCellDef="let row" (click)="viewPaymentLedgerEntry(row)"
                        data-label="Fresh/Stab">{{row.fresh_stab}}</td>
                </ng-container>

                <ng-container matColumnDef="cycle_statement">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Cycle Statement</th>
                    <td mat-cell *matCellDef="let row" (click)="viewPaymentLedgerEntry(row)"
                        data-label="Cycle Statement">{{row.cycle_statement}}</td>
                </ng-container>

                <ng-container matColumnDef="card_auth">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Card Auth</th>
                    <td mat-cell *matCellDef="let row" (click)="viewPaymentLedgerEntry(row)"
                        data-label="Card Auth">{{row.card_auth}}</td>
                </ng-container>

                <ng-container matColumnDef="dpd_r">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>DPD R</th>
                    <td mat-cell *matCellDef="let row" (click)="viewPaymentLedgerEntry(row)"
                        data-label="DPD R">{{row.dpd_r}}</td>
                </ng-container>

                <ng-container matColumnDef="mindue_manual">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Mindue Manual</th>
                    <td mat-cell *matCellDef="let row" (click)="viewPaymentLedgerEntry(row)"
                        data-label="Mindue Manual">{{row.mindue_manual}}</td>
                </ng-container>

                <ng-container matColumnDef="rb_amount">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>RB Amount</th>
                    <td mat-cell *matCellDef="let row" (click)="viewPaymentLedgerEntry(row)"
                        data-label="RB Amount">{{row.rb_amount}}</td>
                </ng-container>

                <ng-container matColumnDef="overdue_amount">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Overdue Amount</th>
                    <td mat-cell *matCellDef="let row" (click)="viewPaymentLedgerEntry(row)"
                        data-label="Overdue Amount">{{row.overdue_amount}}</td>
                </ng-container>

                <ng-container matColumnDef="due_since_date">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Due Since Date</th>
                    <td mat-cell *matCellDef="let row" (click)="viewPaymentLedgerEntry(row)"
                        data-label="Due Since Date">{{row.due_since_date | date:'dd-MMM-yyyy'}}</td>
                </ng-container>

                <ng-container matColumnDef="last_month_paid_unpaid">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Last Month Paid/Unpaid</th>
                    <td mat-cell *matCellDef="let row" (click)="viewPaymentLedgerEntry(row)"
                        data-label="Last Month Paid/Unpaid">{{row.last_month_paid_unpaid}}</td>
                </ng-container>

                <ng-container matColumnDef="last_usage_date">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Last Usage Date</th>
                    <td mat-cell *matCellDef="let row" (click)="viewPaymentLedgerEntry(row)"
                        data-label="Last Usage Date">{{row.last_usage_date}}</td>
                </ng-container>

                <ng-container matColumnDef="dpd_string">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>DPD String</th>
                    <td mat-cell *matCellDef="let row" (click)="viewPaymentLedgerEntry(row)"
                        data-label="DPD String">{{row.dpd_string}}</td>
                </ng-container>

                <ng-container matColumnDef="monthly_income">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Monthly Income</th>
                    <td mat-cell *matCellDef="let row" (click)="viewPaymentLedgerEntry(row)"
                        data-label="Monthly Income">{{row.monthly_income}}</td>
                </ng-container>
                <!-- <ng-container matColumnDef="ghrc_offer_1">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>GHRC Offer 1</th>
                    <td mat-cell *matCellDef="let row">{{row.ghrc_offer_1}}</td>
                </ng-container>
                <ng-container matColumnDef="ghrc_offer_2">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>GHRC Offer 2</th>
                    <td mat-cell *matCellDef="let row">{{row.ghrc_offer_2}}</td>
                </ng-container>
                <ng-container matColumnDef="ghrc_offer_3">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>GHRC Offer 3</th>
                    <td mat-cell *matCellDef="let row">{{row.ghrc_offer_3}}</td>
                </ng-container> -->

                <!-- <ng-container matColumnDef="expand">
                    <th mat-header-cell *matHeaderCellDef aria-label="row actions">&nbsp;</th>
                    <td mat-cell *matCellDef="let element">
                        <button mat-icon-button aria-label="expand row"
                            (click)="(expandedElement = expandedElement === element ? null : element); $event.stopPropagation()">
                            <mat-icon *ngIf="expandedElement === element">keyboard_arrow_up</mat-icon>
                            <mat-icon *ngIf="expandedElement != element">keyboard_arrow_down</mat-icon>
                        </button>
                    </td>
                </ng-container>
                <ng-container matColumnDef="expandedDetail">
                    <td mat-cell *matCellDef="let element" [attr.colspan]="columnsToDisplayWithExpand.length">
                        <div class="example-element-detail"
                            [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">
                            table-row-expanded
                         
                        </div>
                    </td>
                </ng-container> -->

                <tr mat-header-row *matHeaderRowDef="columnsToDisplayWithExpand"></tr>
                <tr mat-row *matRowDef="let row; columns: columnsToDisplayWithExpand;"></tr>
                <tr class="mat-row" *matNoDataRow>
                    <td class="mat-cell" colspan="7">No payment(s) entry found</td>
                </tr>
                <!-- <tr class="mat-row msg" *matNoDataRow ngIf="resultsLength==0">
                    <td class="mat-cell" colspan="7">No payment(s) history found</td>
                </tr> -->
                <!-- <tr mat-row *matRowDef="let element; columns: columnsToDisplayWithExpand;"
                    class="example-element-row" [class.example-expanded-row]="expandedElement === element"
                    (click)="expandedElement = expandedElement === element ? null : element">
                </tr> -->
                <!-- <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr> -->
            </table>
            <mat-paginator [length]="resultsLength" [pageSize]="30" aria-label="Select page of logs"
                showFirstLastButtons></mat-paginator>
        </div>
    </mat-card>
</div>