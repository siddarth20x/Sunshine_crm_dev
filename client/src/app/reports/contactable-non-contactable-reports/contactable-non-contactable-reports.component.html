<div class="_row">
  <div class="col-2">
    <mat-form-field appearance="outline" class="mat_form_fields">
      <mat-label>From Date</mat-label>
      <input matInput [matDatepicker]="from" [value]="fromDate" (dateChange)="fromDateHandler($event)" />
      <mat-hint>DD/MM/YYYY</mat-hint>
      <mat-datepicker-toggle matSuffix [for]="from"> </mat-datepicker-toggle>
      <mat-datepicker #from></mat-datepicker>
    </mat-form-field>
  </div>
  <div class="col-2">
    <mat-form-field appearance="outline" class="mat_form_fields">
      <mat-label>To Date</mat-label>
      <input matInput [matDatepicker]="to" [value]="toDate" (dateChange)="toDateHandler($event)" />
      <mat-hint>DD/MM/YYYY</mat-hint>
      <mat-datepicker-toggle matSuffix [for]="to"> </mat-datepicker-toggle>
      <mat-datepicker #to></mat-datepicker>
    </mat-form-field>
  </div>
  <div class="col-2" *ngIf="showUserFilter">
    <mat-form-field appearance="outline" class="mat_form_fields">
      <mat-label>Users</mat-label>
      <input type="text" placeholder="Pick one" aria-label="Number" matInput [formControl]="agentFullName"
        [matAutocomplete]="auto" />
      <button *ngIf="dailyRepParams.agent_id !== null" mat-icon-button matSuffix aria-label="Clear"
        (click)="clearAgentSelection()">
        <mat-icon>clear</mat-icon>
      </button>
      <mat-autocomplete #auto="matAutocomplete" (optionSelected)="agentHandler($event.option.value)">
        <mat-option *ngFor="let option of agentFilteredOptions | async" [value]="option.full_name">
          {{ option.full_name }}
          <sub>({{ option.user_id }} | {{ option.role_name | uppercase }})</sub>
        </mat-option>
      </mat-autocomplete>
    </mat-form-field>
  </div>
  <div class="col-2">
    <mat-form-field appearance="outline" class="mat_form_fields" [class.disabled-field]="!dailyRepParams.agent_id && loggedInUserRoleName !== 'AGENT'">
      <mat-label>Bank</mat-label>
      <input type="text" placeholder="Pick one" aria-label="Number" matInput [formControl]="companyName"
        [matAutocomplete]="cmp" [disabled]="!dailyRepParams.agent_id && loggedInUserRoleName !== 'AGENT'" [readonly]="!dailyRepParams.agent_id && loggedInUserRoleName !== 'AGENT'" />
      <button *ngIf="dailyRepParams.company_id !== null" mat-icon-button matSuffix aria-label="Clear"
        (click)="clearcompanySelection()">
        <mat-icon>clear</mat-icon>
      </button>
      <mat-autocomplete #cmp="matAutocomplete" (optionSelected)="companyHandler($event.option.value)">
        <mat-option *ngFor="let option of companyNameFilteredOptions | async" [value]="option.company_name">
          {{ option.company_name }}
        </mat-option>
      </mat-autocomplete>
    </mat-form-field>
  </div>
  <div class="col-sm">
    <mat-form-field appearance="outline" class="mat_form_fields">
      <mat-label>Contactable / Non-contactable</mat-label>
      <mat-select name="stage" (selectionChange)="contactableHandler($event)" [value]="selectedStage">
        <mat-option *ngFor="let stage of stageArr" [value]="stage">
          {{ stage }}
        </mat-option>
      </mat-select>
    </mat-form-field>
  </div>
</div>

<!-- Feedback message below bank field only -->
<div class="_row" *ngIf="!dailyRepParams.agent_id && loggedInUserRoleName !== 'AGENT'">
  <div class="col-sm"></div>
  <div class="col-sm">
    <div class="feedback-message">
      <span class="message-text">Please Select a User First To Enable Bank Selection</span>
    </div>
  </div>
</div>

<div class="_row">
  <div class="col-sm report_btns">
    <button mat-raised-button class="btnGen" [disabled]="disableGenerateBtn"
      (click)="generateCNCReport(loggedInUserId)">
      Generate
    </button>
    <button mat-raised-button class="btnGen" (click)="
        exportToExcelFormat(myDataArray, 'Contactable/Non-Contactable Report')
      " [disabled]="disableExportBtn">
      Export To Excel
    </button>
  </div>
</div>
<mat-progress-bar mode="indeterminate" *ngIf="showProgressBar"></mat-progress-bar>
<div class="table__row" *ngIf="showCNCTBLBtn">
  <mat-card class="table__card" *ngIf="resultsLength > 0">
    <!-- <mat-progress-bar mode="indeterminate" *ngIf="showProgressBar"></mat-progress-bar> -->
    <mat-card-header class="table__header">
      <mat-card-title>Contactable / Non-contactable Reports</mat-card-title>
      <mat-form-field appearance="standard">
        <mat-label>Filter</mat-label>
        <input matInput (keyup)="applyFilter($event)" #input />
      </mat-form-field>
    </mat-card-header>
    <div class="table-container">
      <div class="mat-elevation-z8 table-wrapper">
        <table mat-table [dataSource]="dataSource" multiTemplateDataRows>
          <ng-container matColumnDef="lead_id">
            <th mat-header-cell *matHeaderCellDef>Lead Id</th>
            <td mat-cell *matCellDef="let row" data-label="Lead Id">
              {{ row.lead_id }}
            </td>
          </ng-container>
          <ng-container matColumnDef="company_name">
            <th mat-header-cell *matHeaderCellDef>Bank</th>
            <td mat-cell *matCellDef="let row" data-label="Bank">
              {{ row.company_name }}
            </td>
          </ng-container>
          <ng-container matColumnDef="product_type">
            <th mat-header-cell *matHeaderCellDef>Product Type</th>
            <td mat-cell *matCellDef="let row" data-label="Product Type">
              {{ row.product_type }}
            </td>
          </ng-container>
          <ng-container matColumnDef="customer_id">
            <th mat-header-cell *matHeaderCellDef>Customer Id</th>
            <td mat-cell *matCellDef="let row" data-label="Customer Id">
              {{ row.customer_id }}
            </td>
          </ng-container>
          <ng-container matColumnDef="account_number">
            <th mat-header-cell *matHeaderCellDef>Account Number</th>
            <td mat-cell *matCellDef="let row" data-label="Account Number">
              {{ row.account_number }}
            </td>
          </ng-container>
          <ng-container matColumnDef="contacble_non_contactable">
            <th mat-header-cell *matHeaderCellDef>Contactable / Non Contactable</th>
            <td mat-cell *matCellDef="let row" data-label="Contacble / Non Contactable">
              {{ row.stage }}
            </td>
          </ng-container>
          <ng-container matColumnDef="agreement_id">
            <th mat-header-cell *matHeaderCellDef>Agreement ID</th>
            <td mat-cell *matCellDef="let row">
              {{ row.agreement_id }}
            </td>
          </ng-container>
          <ng-container matColumnDef="customer_name">
            <th mat-header-cell *matHeaderCellDef>Customer Name</th>
            <td mat-cell *matCellDef="let row">
              {{ row.customer_name }}
            </td>
          </ng-container>
          <ng-container matColumnDef="total_outstanding_amount">
            <th mat-header-cell *matHeaderCellDef>TOS</th>
            <td mat-cell *matCellDef="let row">
              {{ row.total_outstanding_amount }}
            </td>
          </ng-container>
          <ng-container matColumnDef="tracing_source_type_name">
            <th mat-header-cell *matHeaderCellDef>Trace Source</th>
            <td mat-cell *matCellDef="let row">
              {{ row.tracing_source_type_name }}
            </td>
          </ng-container>
          <ng-container matColumnDef="visa_status">
            <th mat-header-cell *matHeaderCellDef>Visa Status</th>
            <td mat-cell *matCellDef="let row">
              {{ row.visa_status }}
            </td>
          </ng-container>
          <ng-container matColumnDef="mol_status">
            <th mat-header-cell *matHeaderCellDef>MOL Status</th>
            <td mat-cell *matCellDef="let row">
              {{ row.mol_status }}
            </td>
          </ng-container>
          <ng-container matColumnDef="note">
            <th mat-header-cell *matHeaderCellDef>Note</th>
            <td mat-cell *matCellDef="let row">
              {{ row.note }}
            </td>
          </ng-container>
          <ng-container matColumnDef="stage_status_code">
            <th mat-header-cell *matHeaderCellDef>Code</th>
            <td mat-cell *matCellDef="let row">
              {{ row.stage_status_code }}
            </td>
          </ng-container>
          <ng-container matColumnDef="assigned_to_full_name">
            <th mat-header-cell *matHeaderCellDef>Assigned To</th>
            <td mat-cell *matCellDef="let row">
              {{ row.assigned_to_full_name }}
            </td>
          </ng-container>
          <ng-container matColumnDef="assigned_by_full_name">
            <th mat-header-cell *matHeaderCellDef>Assigned By</th>
            <td mat-cell *matCellDef="let row">
              {{ row.assigned_by_full_name }}
            </td>
          </ng-container>
          <ng-container matColumnDef="team_manager_full_name">
            <th mat-header-cell *matHeaderCellDef>Team Manager</th>
            <td mat-cell *matCellDef="let row">
              {{ row.team_manager_full_name }}
            </td>
          </ng-container>
          <ng-container matColumnDef="senior_manager_full_name">
            <th mat-header-cell *matHeaderCellDef>Senior Manager</th>
            <td mat-cell *matCellDef="let row">
              {{ row.senior_manager_full_name }}
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="columnsToDisplayWithExpand"></tr>
          <tr mat-row *matRowDef="let element; columns: columnsToDisplayWithExpand" class="example-element-row"
            [class.example-expanded-row]="expandedElement === element" (click)="
            expandedElement = expandedElement === element ? null : element
          "></tr>
          <!-- <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr> -->
        </table>
      </div>
    </div>
    <mat-paginator [length]="resultsLength" [pageSize]="30" aria-label="Select page of logs"
      showFirstLastButtons></mat-paginator>
  </mat-card>
</div>
<br />
<div *ngIf="resultsLength == 0" class="noDataFound">
  <p>
    <strong> No records found </strong>
  </p>
  <p>
    <button mat-stroked-button class="clearFilters" color="primary" (click)="clearFilters()">
      Clear your filters and try again
    </button>
  </p>
</div>